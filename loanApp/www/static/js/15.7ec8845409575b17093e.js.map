{"version":3,"sources":["webpack:///src/components/mortgageLoan/approval/reports.vue","webpack:///./src/components/mortgageLoan/approval/reports.vue?f1e2","webpack:///./src/components/mortgageLoan/approval/reports.vue"],"names":["reports","data","reportObj","obj","time","type","errorMessage","created","this","_getReport","methods","goback","$router","push","path","customer","id","selected","model","parseInt","Date","getTime","_this","asyncToGenerator_default","regenerator_default","a","mark","_callee","rootId","evaluateId","wrap","_context","prev","next","Object","api","then","res","evaluateInfo","find","process","name","result","commonFunction","stop","editReport","item","$refs","unreported","show","deleteReport","index","houseArr","length","splice","checkDataValite","isError","some","report","topTip","submit","_this2","forEach","reportType","arr","concat","stringify_default","computed","extends_default","vuex_esm","components","vHeader","header","rsList","rslist","rsText","rstext","rsSelect","rsselect","top_tip","approval_reports","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","title","on","_v","slot","label","value","selectText","isDate","_l","eachHouseReports","key","number","_s","_e","directives","rawName","expression","click","$event","ref","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/15.7ec8845409575b17093e.js","sourcesContent":["<template>\n    <div class=\"reports\">\n        <v-header title=\"测评报告管理\" @goback=\"goback\" @submit=\"submit\" next=\"提交\"></v-header>\n        <rs-list>\n            <ul slot=\"body\">\n                <li><rs-text label=\"房产编号\" :value=\"customer.id\"></rs-text></li>\n                <li><rs-select selectText=\"完成时间\" model=\"time\" @selected=\"selected\" :isDate=\"true\"></rs-select></li>\n            </ul>\n            <div slot=\"footer\">\n              <div v-for=\"(eachHouseReports, index) in reports\" :key=\"index\">        \n                <!-- 表单显示 -->\n                <div class=\"report-wrapper\" v-for=\"(item, number) in eachHouseReports\" :key=\"number\">\n                    <!-- 如果存在id值 则表示该报告已经填写 -->\n                    <div class=\"report-content\" v-if=\"item.houseId\">\n                        <h2 class=\"title\">房产{{index+1}}报告</h2>\n                    </div>\n                    <!-- 报告footer操作区 -->\n                    <div class=\"report-footer\">\n                        <div class=\"delete\" @click=\"deleteReport(number, eachHouseReports)\" v-show=\"eachHouseReports.length > 1\">\n                            <i class=\"el-icon-delete icon\"></i>\n                            <span>删除</span>\n                        </div>\n                        <div class=\"edit\" @click=\"editReport(item)\">\n                            <i class=\"el-icon-edit-outline icon\"></i>\n                            <span>编辑</span>\n                        </div>  \n                    </div>\n                </div>\n              </div>   \n            </div>\n        </rs-list>\n       \n        <top-tip ref=\"topTip\">\n            <div class=\"tip-title\">\n                <i class=\"fa fa-ban icon\"></i>\n                <span class=\"text\">{{errorMessage}}</span>\n            </div>\n            \n        </top-tip>\n        <unreported :obj=\"reportObj\" ref=\"unreported\"></unreported>\n    </div>\n</template>\n\n<script>\nimport vHeader from 'components/header/header';\nimport unreported from 'components/mortgageLoan/valuations/unreported';\nimport rsList from 'base/rslist/rslist';\nimport rsText from 'base/rstext/rstext';\nimport rsSelect from 'base/rsselect/rsselect';\nimport {mapGetters} from 'vuex';\nimport {formalReport, getProcess, getReports} from 'api/api';\nimport topTip from 'base/top-tip/top-tip';\nimport {seprateArr} from '@/utils/commonFunction'\nexport default {\n  data() {\n    return {\n      reportObj: {},\n      obj: {\n        time: '',\n        type: 2,\n      },\n      reports: [],\n      errorMessage: ''\n    };\n  },\n  created() {\n    this._getReport()\n  },\n  methods: {\n    goback() {\n      this.$router.push({path:`/approve/${this.customer.id}`});\n    },\n    selected(id, model) {\n      if (model === 'time') {\n        this.obj[model] = new Date(id).getTime();\n        return;\n      }\n      this.obj[model] = parseInt(id);\n    },\n    /**获取预评报告内容 */\n    async _getReport() {\n      const rootId = this.customer.rootId;\n      let evaluateId;\n      await getProcess(rootId).then(res => {\n        const evaluateInfo = res.data.find(process => {\n          return process.name === 'order';\n        });\n        evaluateId = evaluateInfo.id;\n      });\n\n      getReports(evaluateId).then(res => {\n        if (res.result) {\n          this.reports = seprateArr(res.data)\n        }\n      });\n    },\n    editReport(item) {\n      this.reportObj = item;\n      this.$refs.unreported.show();\n    },\n    deleteReport(index, houseArr) {\n      if(houseArr.length === 1){\n        return\n      }\n      houseArr.splice(index, 1);\n    },\n    /**正评 每个房屋只能有一份报告。 */\n    checkDataValite() {\n      let isError = this.reports.some(report => {\n        return report.length > 1;\n      });\n      \n      if(isError) {\n        this.errorMessage = '每个房子只能有一份正评';\n        this.$refs.topTip.show();\n      }\n      if(typeof this.obj.time !== 'number') {\n        this.errorMessage = '时间不能为空'\n        this.$refs.topTip.show()\n        return true\n      }\n      return isError;\n    },\n    submit() {\n      if (this.checkDataValite()) {\n        return;\n      }\n      this.reports.forEach(report => {\n        report.forEach(item => {\n          item.reportType = this.obj.type;\n          item.type = this.obj.type;\n          item.time = this.obj.time;\n        });\n      });\n      /**二维数组处理成一维数组 */\n      let data = []\n      this.reports.forEach(arr =>{\n        data = data.concat(arr)\n      })\n      formalReport(this.customer.id, this.obj.time, JSON.stringify(data)).then(res =>{\n        res.result && this.$router.push({path:`/approve`})\n      })\n    },\n  },\n  computed: {\n    ...mapGetters(['customer']),\n  },\n  components: {\n    vHeader,\n    unreported,\n    rsList,\n    rsText,\n    rsSelect,\n    topTip,\n  },\n};\n</script>\n\n<style lang='stylus' scoped>\n@import '~common/stylus/variable';\n@import '~common/stylus/mixin';\n\n.reports {\n    position: fixed;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: $color-background;\n    overflow: auto;\n\n    .report-wrapper {\n        width: 100%;\n        height: 100px;\n        background: $color-white;\n        margin: 10px 0;\n\n        .report-content {\n            box-sizing: border-box;\n            width: 100%;\n            height: 70px;\n            border-bottom: 1px solid $color-border;\n            padding: 15px;\n\n            .title {\n                font-weight: 700;\n            }\n\n            .text {\n                width: 100%;\n                margin-top: 10px;\n                font-size: $font-size-medium;\n\n                .text-right {\n                    float: right;\n                }\n            }\n        }\n\n        .report-footer {\n            line-height: 30px;\n            height: 30px;\n\n            .icon {\n                font-size: $font-size-large;\n            }\n\n            .edit, .delete {\n                float: right;\n                font-size: $font-size-medium;\n                margin-right: 10px;\n                extend-click();\n            }\n        }\n    }\n\n    .tip-title {\n        text-align: center;\n        padding: 18px 0;\n        font-size: 0;\n\n        .icon {\n            font-size: $font-size-medium;\n            color: $bello-active;\n            margin-right: 4px;\n        }\n\n        .text {\n            font-size: $font-size-medium;\n            color: $pure-white;\n        }\n    }\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/mortgageLoan/approval/reports.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"reports\"},[_c('v-header',{attrs:{\"title\":\"测评报告管理\",\"next\":\"提交\"},on:{\"goback\":_vm.goback,\"submit\":_vm.submit}}),_vm._v(\" \"),_c('rs-list',[_c('ul',{attrs:{\"slot\":\"body\"},slot:\"body\"},[_c('li',[_c('rs-text',{attrs:{\"label\":\"房产编号\",\"value\":_vm.customer.id}})],1),_vm._v(\" \"),_c('li',[_c('rs-select',{attrs:{\"selectText\":\"完成时间\",\"model\":\"time\",\"isDate\":true},on:{\"selected\":_vm.selected}})],1)]),_vm._v(\" \"),_c('div',{attrs:{\"slot\":\"footer\"},slot:\"footer\"},_vm._l((_vm.reports),function(eachHouseReports,index){return _c('div',{key:index},_vm._l((eachHouseReports),function(item,number){return _c('div',{key:number,staticClass:\"report-wrapper\"},[(item.houseId)?_c('div',{staticClass:\"report-content\"},[_c('h2',{staticClass:\"title\"},[_vm._v(\"房产\"+_vm._s(index+1)+\"报告\")])]):_vm._e(),_vm._v(\" \"),_c('div',{staticClass:\"report-footer\"},[_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(eachHouseReports.length > 1),expression:\"eachHouseReports.length > 1\"}],staticClass:\"delete\",on:{\"click\":function($event){_vm.deleteReport(number, eachHouseReports)}}},[_c('i',{staticClass:\"el-icon-delete icon\"}),_vm._v(\" \"),_c('span',[_vm._v(\"删除\")])]),_vm._v(\" \"),_c('div',{staticClass:\"edit\",on:{\"click\":function($event){_vm.editReport(item)}}},[_c('i',{staticClass:\"el-icon-edit-outline icon\"}),_vm._v(\" \"),_c('span',[_vm._v(\"编辑\")])])])])}))}))]),_vm._v(\" \"),_c('top-tip',{ref:\"topTip\"},[_c('div',{staticClass:\"tip-title\"},[_c('i',{staticClass:\"fa fa-ban icon\"}),_vm._v(\" \"),_c('span',{staticClass:\"text\"},[_vm._v(_vm._s(_vm.errorMessage))])])]),_vm._v(\" \"),_c('unreported',{ref:\"unreported\",attrs:{\"obj\":_vm.reportObj}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler?{\"id\":\"data-v-c76e7d1e\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.7.3@vue-loader/lib/selector.js?type=template&index=0!./src/components/mortgageLoan/approval/reports.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/_extract-text-webpack-plugin@3.0.2@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-c76e7d1e\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!stylus-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=styles&index=0!./reports.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./reports.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=script&index=0!./reports.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-c76e7d1e\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/_vue-loader@13.7.3@vue-loader/lib/selector?type=template&index=0!./reports.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-c76e7d1e\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/mortgageLoan/approval/reports.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}