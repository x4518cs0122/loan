webpackJsonp([43],{KI15:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("3cXf"),s=r.n(o),i=r("4YfN"),a=r.n(i),n=r("aA9S"),l=r.n(n),u=r("hxP8"),p=r("iMdm"),c=r("MMGN"),d=r("P9rx"),h=r("u9a8"),v=r("9rMa"),f=r("P9l9"),m=r("rGUG"),b={data:function(){return{options:{reportType:[{id:"1",value:"预评"},{id:"2",value:"正评"}]},reportObj:{},obj:{time:"",type:""},reports:[],errorMessage:""}},created:function(){this.reportDemo={id:null,orderId:null,reportType:null,reportObligee:null,reportBorrower:null,reportRepose:null,reportHouseAge:null,reportHouseArea:null,reportHouseSingle:null,reportHouseTotal:null,reportLoanAmount:null,reportLoanYear:null,reportFirst:null,houseId:null,time:null,type:null},this.getHousesNumber()},methods:{goback:function(){this.$router.back()},selected:function(e,t){this.obj[t]="time"!==t?parseInt(e):new Date(e).getTime()},getHousesNumber:function(){var e=this,t=this.customer.rootId+1;Object(f.C)(t).then(function(t){e.reports=t.data.houses.map(function(r){return[l()(a()({},e.reportDemo),{reportHouseArea:parseFloat(r.area),reportHouseSingle:parseFloat(r.enquiryResult),reportHouseTotal:parseFloat(r.totalPrice),reportLoanAmount:parseFloat(t.data.loanAmount)||"",houseId:parseInt(r.id),reportBorrower:t.data.clientName||"",orderId:e.customer.id})]})})},addReport:function(e,t){if(t.length>1)return this.errorMessage="每个房产最多添加2份报告",void this.$refs.topTip.show();var r=l()(a()({},this.reportDemo),{houseId:e,orderId:this.customer.id});t.push(r)},editReport:function(e){this.reportObj=e,this.$refs.unreported.show()},deleteReport:function(e,t){t.splice(e,1)},checkDataValite:function(){var e=!1;return 2===this.obj.type&&(e=this.reports.some(function(e){return e.length>1}),this.errorMessage="每个房子只能有一份正评"),e},submit:function(){var e=this;if(this.checkDataValite())this.$refs.topTip.show();else{this.reports.forEach(function(t){t.forEach(function(t){t.reportType=e.obj.type,t.type=e.obj.type,t.time=e.obj.time})});var t={time:this.obj.time,type:this.obj.type,orderId:this.customer.id,report:s()(this.reports)};Object(f._8)(this.customer.id,t).then(function(t){t.result&&e.$router.push({path:"/evaluate"})})}}},computed:a()({},Object(v.b)(["customer"])),components:{vHeader:u.a,unreported:p.a,rsList:c.a,rsText:d.a,rsSelect:h.a,topTip:m.a}},_={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"reports"},[r("v-header",{attrs:{title:"测评报告管理",next:"提交"},on:{goback:e.goback,submit:e.submit}}),e._v(" "),r("rs-list",[r("ul",{attrs:{slot:"body"},slot:"body"},[r("li",[r("rs-text",{attrs:{label:"房产编号",value:e.customer.id}})],1),e._v(" "),r("li",[r("rs-select",{attrs:{selectText:"完成时间",model:"time",isDate:!0},on:{selected:e.selected}})],1),e._v(" "),r("li",[r("rs-select",{attrs:{selectText:"报告类型",options:e.options.reportType,model:"type"},on:{selected:e.selected}})],1)]),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},e._l(e.reports,function(t,o){return r("div",{key:o},e._l(t,function(s,i){return r("div",{key:i,staticClass:"report-wrapper"},[s.houseId?r("div",{staticClass:"report-content"},[r("h2",{staticClass:"title"},[e._v("房产"+e._s(o+1)+"报告")])]):e._e(),e._v(" "),r("div",{staticClass:"report-footer"},[r("div",{directives:[{name:"show",rawName:"v-show",value:i>0,expression:"number > 0"}],staticClass:"delete",on:{click:function(r){e.deleteReport(i,t)}}},[r("i",{staticClass:"el-icon-delete icon"}),e._v(" "),r("span",[e._v("删除")])]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:0===i,expression:"number === 0"}],staticClass:"delete",on:{click:function(r){e.addReport(s.houseId,t)}}},[r("i",{staticClass:"fa fa-plus",attrs:{"aria-hidden":"true"}}),e._v(" "),r("span",[e._v("新建报告")])]),e._v(" "),r("div",{staticClass:"edit",on:{click:function(t){e.editReport(s)}}},[r("i",{staticClass:"el-icon-edit-outline icon"}),e._v(" "),r("span",[e._v("编辑")])])])])}))}))]),e._v(" "),r("top-tip",{ref:"topTip"},[r("div",{staticClass:"tip-title"},[r("i",{staticClass:"fa fa-ban icon"}),e._v(" "),r("span",{staticClass:"text"},[e._v(e._s(e.errorMessage))])])]),e._v(" "),r("unreported",{ref:"unreported",attrs:{obj:e.reportObj}})],1)},staticRenderFns:[]};var y=r("C7Lr")(b,_,!1,function(e){r("cvDs")},"data-v-36138692",null);t.default=y.exports},cvDs:function(e,t){}});
//# sourceMappingURL=43.4a30caf2d7c94e718a57.js.map